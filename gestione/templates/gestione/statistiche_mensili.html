{% extends 'gestione/base.html' %}
{% load bootstrap5 %}

{% block title %}Statistiche Mensili{% endblock %}

{% block content %}
<div class="container pt-4">

    <div class="row justify-content-center">
        <div class="col-lg-10">

            <h1 class="h4 mb-4">Costi Manuali Mensili</h1>

            <div class="card bg-light mb-4">
                <div class="card-body">
                    <form method="GET" action="{% url 'statistiche_mensili' %}" class="row g-3 align-items-center">
                        <div class="col-md-5">
                            <label for="anno" class="form-label">Anno</label>
                            <select name="anno" id="anno" class="form-select form-select-sm">
                                {% for a in anni_disponibili %}
                                    <option value="{{ a }}" {% if a == anno_selezionato %}selected{% endif %}>{{ a }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-5">
                            <label for="mese" class="form-label">Mese</label>
                            <select name="mese" id="mese" class="form-select form-select-sm">
                                {% for m in "1"|ljust:12 %} {# Crea una sequenza da 1 a 12 #}
                                <option value="{{ forloop.counter }}" {% if forloop.counter == mese_selezionato %}selected{% endif %}>
                                    {{ forloop.counter }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-2" style="margin-top: 2rem;">
                            <button type="submit" class="btn btn-primary btn-sm w-100">Carica</button>
                        </div>
                    </form>
                </div>
            </div>

            <div class="card">
                 <div class="card-header">
                     Dati per: {{ mese_selezionato }}/{{ anno_selezionato }}
                 </div>
                 <div class="card-body">
                     <p class="text-muted">Inserisci qui i costi che non possono essere calcolati automaticamente dal sistema (come marketing e costi fissi generali).</p>
                     <hr>
                     <form method="POST">
                         {% csrf_token %}
                         
                         {# Renderizza i campi Anno e Mese come nascosti nel POST #}
                         {{ form.anno.as_hidden }}
                         {{ form.mese.as_hidden }}

                         <div class="row mb-3">
                             <div class="col-md-6">
                                 {% bootstrap_field form.costo_marketing_mese %}
                             </div>
                             <div class="col-md-6">
                                 {% bootstrap_field form.costi_operativi_fissi %}
                             </div>
                         </div>
                         
                         <div class="row mb-3">
                             <div class="col-md-6">
                                  {% bootstrap_field form.finanziamenti_non_approvati %}
                             </div>
                         </div>
                         
                         <hr>
                         <div class="text-end">
                              {% bootstrap_button button_type="submit" content="Salva Dati Mensili" button_class="btn-success" %}
                         </div>
                     </form>
                 </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}